---
phase: 01-wasm-pipeline-document-service
plan: "05"
type: execute
wave: 4
depends_on:
  - "01-03"
  - "01-04"
files_modified:
  - src/components/EntryScreen/EntryScreen.tsx
  - src/components/TextPreview/TextPreview.tsx
  - src/components/RSVPPlaceholder/RSVPPlaceholder.tsx
  - src/App.tsx
autonomous: true
requirements:
  - DOCF-01
  - IMPT-04

must_haves:
  truths:
    - "Import button is disabled until WASM Worker sends Init success"
    - "User can drag-and-drop a PDF onto the drop zone and it triggers parsing"
    - "User can click the file picker button to open a PDF from device storage"
    - "User can paste raw text into a textarea and submit it — no WASM involved"
    - "During PDF parsing, a spinner appears over the import area with a Cancel button"
    - "After 3 seconds of parsing, a patience message appears ('Large file, this may take a moment...')"
    - "A scanned/image PDF shows an actionable error message that auto-dismisses after 4 seconds"
    - "Successful parse navigates to /preview, which shows first paragraph + word count + Start Reading button"
    - "Start Reading navigates to /read (placeholder RSVP screen) and Back returns to /"
    - "System theme (OS light/dark preference) is used — no manual toggle"
  artifacts:
    - path: "src/components/EntryScreen/EntryScreen.tsx"
      provides: "File drop zone + file picker + paste text (secondary) + loading states + error display"
      min_lines: 120
    - path: "src/components/TextPreview/TextPreview.tsx"
      provides: "First paragraph preview + word count + Start Reading button (top) + Back button"
      min_lines: 40
    - path: "src/components/RSVPPlaceholder/RSVPPlaceholder.tsx"
      provides: "Placeholder RSVP screen — makes phase end-to-end testable"
      min_lines: 20
  key_links:
    - from: "src/components/EntryScreen/EntryScreen.tsx"
      to: "src/services/document-service.ts"
      via: "documentService.parseFile(file) and documentService.parseText(text)"
      pattern: "documentService"
    - from: "src/components/EntryScreen/EntryScreen.tsx"
      to: "src/store/rsvp-store.ts"
      via: "useRsvpStore().setDocument(words, title) after successful parse"
      pattern: "setDocument"
    - from: "src/components/EntryScreen/EntryScreen.tsx"
      to: "react-router-dom"
      via: "useNavigate() to navigate('/preview') on success"
      pattern: "navigate.*preview"
    - from: "src/components/TextPreview/TextPreview.tsx"
      to: "src/store/rsvp-store.ts"
      via: "useRsvpStore() reads wordList and documentTitle"
      pattern: "useRsvpStore"
---

<objective>
Build the three user-facing screens that make Phase 1 end-to-end testable: EntryScreen (import hero), TextPreview (quality check before reading), and RSVPPlaceholder (confirms navigation works). Also wires App.tsx to use the real components instead of the Plan 03 placeholders.

Purpose: Phase 1 success criteria require a human to verify the full flow: paste text → preview → placeholder RSVP, and PDF import → preview → placeholder RSVP. These screens are the user-visible evidence that the pipeline works.

Output: Three component files. App.tsx updated to import real components. The complete import-to-preview flow is testable end-to-end.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-wasm-pipeline-document-service/01-RESEARCH.md
@.planning/phases/01-wasm-pipeline-document-service/01-CONTEXT.md
@.planning/phases/01-wasm-pipeline-document-service/01-03-SUMMARY.md
@.planning/phases/01-wasm-pipeline-document-service/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build EntryScreen component with all locked UI decisions</name>
  <files>
    src/components/EntryScreen/EntryScreen.tsx
  </files>
  <action>
Create `src/components/EntryScreen/EntryScreen.tsx`.

User decisions (NON-NEGOTIABLE from CONTEXT.md):
- Import is the hero action — file picker/drag-and-drop zone is the primary CTA
- Paste text is secondary — accessible but not prominent (small section below drop zone)
- Basic header: app name + settings icon at top, import content below
- System default theme (matches OS light/dark — use Tailwind's dark: variants)
- WASM init: silent — import button disabled until ready, no spinner or message for init
- PDF processing: spinner over the import area while processing
- Long PDF (3s+): patience message "Large file, this may take a moment..."
- Cancel button visible during PDF processing
- Error messages: actionable + suggestion, auto-dismiss after ~4 seconds
- Entry screen resets to fresh state each visit (no persisted error state)

```typescript
import React, { useState, useCallback, useEffect, useRef } from 'react'
import { useNavigate } from 'react-router-dom'
import { documentService } from '../../services/document-service'
import { useRsvpStore } from '../../store/rsvp-store'

export default function EntryScreen() {
  const navigate = useNavigate()
  const setDocument = useRsvpStore((s) => s.setDocument)
  const isWorkerReady = useRsvpStore((s) => s.isWorkerReady)
  const setWorkerReady = useRsvpStore((s) => s.setWorkerReady)

  const [isDragOver, setIsDragOver] = useState(false)
  const [isProcessing, setIsProcessing] = useState(false)
  const [showPatience, setShowPatience] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [pasteText, setPasteText] = useState('')

  // AbortController-style cancel signal for in-progress parses
  const cancelRef = useRef(false)
  const patienceTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)
  const errorTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)

  // Signal worker readiness to store — enables import button
  useEffect(() => {
    documentService.ensureReady().then(() => {
      setWorkerReady(true)
    })
  }, [setWorkerReady])

  // Clear timers on unmount
  useEffect(() => {
    return () => {
      if (patienceTimerRef.current) clearTimeout(patienceTimerRef.current)
      if (errorTimerRef.current) clearTimeout(errorTimerRef.current)
    }
  }, [])

  function showError(message: string) {
    setError(message)
    if (errorTimerRef.current) clearTimeout(errorTimerRef.current)
    // Auto-dismiss after 4 seconds (user decision: "a few seconds")
    errorTimerRef.current = setTimeout(() => setError(null), 4000)
  }

  async function handleFile(file: File) {
    if (!isWorkerReady || isProcessing) return

    cancelRef.current = false
    setIsProcessing(true)
    setError(null)

    // Patience message appears after 3 seconds (user decision)
    patienceTimerRef.current = setTimeout(() => {
      if (!cancelRef.current) setShowPatience(true)
    }, 3000)

    try {
      const result = await documentService.parseFile(file)

      if (cancelRef.current) return // User cancelled mid-parse

      // Guard: very few words = likely scanned/image PDF (also checked in Rust)
      if (result.words.length < 10) {
        throw new Error(
          "No readable text found. This PDF may be scanned or image-based. " +
          "Try a different PDF or paste the text instead."
        )
      }

      setDocument(result.words, result.title)
      navigate('/preview')
    } catch (e) {
      if (cancelRef.current) return
      const msg = e instanceof Error ? e.message : 'Could not read file. Please try again.'
      showError(msg)
    } finally {
      setIsProcessing(false)
      setShowPatience(false)
      if (patienceTimerRef.current) clearTimeout(patienceTimerRef.current)
    }
  }

  function handleCancel() {
    cancelRef.current = true
    setIsProcessing(false)
    setShowPatience(false)
    if (patienceTimerRef.current) clearTimeout(patienceTimerRef.current)
  }

  function handlePasteSubmit() {
    const trimmed = pasteText.trim()
    if (!trimmed) return
    const result = documentService.parseText(trimmed)
    if (result.words.length === 0) {
      showError('No readable text found in the pasted content.')
      return
    }
    setDocument(result.words, null)
    navigate('/preview')
  }

  // Drag and drop handlers
  const onDragOver = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setIsDragOver(true)
  }, [])

  const onDragLeave = useCallback(() => {
    setIsDragOver(false)
  }, [])

  const onDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setIsDragOver(false)
    const file = e.dataTransfer.files[0]
    if (file) handleFile(file)
  }, [isWorkerReady, isProcessing]) // eslint-disable-line react-hooks/exhaustive-deps

  const onFileInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (file) handleFile(file)
    e.target.value = '' // Reset so same file can be re-selected
  }, [isWorkerReady, isProcessing]) // eslint-disable-line react-hooks/exhaustive-deps

  const canImport = isWorkerReady && !isProcessing

  return (
    <div className="min-h-screen bg-white dark:bg-gray-950 flex flex-col">
      {/* Header */}
      <header className="flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-800">
        <h1 className="text-lg font-semibold text-gray-900 dark:text-white tracking-tight">
          RSVP Reader
        </h1>
        {/* Settings icon placeholder — Phase 3 will wire this up */}
        <button
          aria-label="Settings"
          className="p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            strokeWidth={2}
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
            />
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
        </button>
      </header>

      {/* Main import area */}
      <main className="flex-1 flex flex-col items-center justify-center px-4 py-8 gap-6">

        {/* Drop zone — PRIMARY CTA */}
        <div
          onDragOver={onDragOver}
          onDragLeave={onDragLeave}
          onDrop={onDrop}
          className={[
            'relative w-full max-w-md rounded-2xl border-2 border-dashed transition-colors duration-150',
            isDragOver
              ? 'border-blue-500 bg-blue-50 dark:bg-blue-950'
              : 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900',
            isProcessing ? 'pointer-events-none' : '',
          ].join(' ')}
        >
          <div className="flex flex-col items-center justify-center py-12 px-6 text-center gap-4">
            {isProcessing ? (
              <>
                {/* Spinner during PDF processing */}
                <div className="w-10 h-10 rounded-full border-4 border-blue-200 border-t-blue-600 animate-spin" />
                {showPatience && (
                  <p className="text-sm text-gray-500 dark:text-gray-400">
                    Large file, this may take a moment...
                  </p>
                )}
                <button
                  onClick={handleCancel}
                  className="mt-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
                >
                  Cancel
                </button>
              </>
            ) : (
              <>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  className="w-10 h-10 text-gray-300 dark:text-gray-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  strokeWidth={1.5}
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  />
                </svg>
                <div>
                  <p className="text-base font-medium text-gray-700 dark:text-gray-200">
                    Drop a PDF here
                  </p>
                  <p className="text-sm text-gray-400 dark:text-gray-500 mt-1">
                    or use the button below to pick a file
                  </p>
                </div>
                <label
                  className={[
                    'inline-block px-5 py-2.5 text-sm font-medium rounded-xl cursor-pointer transition-colors',
                    canImport
                      ? 'bg-blue-600 text-white hover:bg-blue-700'
                      : 'bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed',
                  ].join(' ')}
                >
                  {/* WASM init is silent — button just says "Choose PDF" */}
                  Choose PDF
                  <input
                    type="file"
                    accept=".pdf,application/pdf"
                    className="sr-only"
                    disabled={!canImport}
                    onChange={onFileInputChange}
                  />
                </label>
              </>
            )}
          </div>
        </div>

        {/* Error message — actionable, auto-dismisses */}
        {error && (
          <div className="w-full max-w-md px-4 py-3 rounded-xl bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800">
            <p className="text-sm text-red-700 dark:text-red-300">{error}</p>
          </div>
        )}

        {/* Paste text — SECONDARY import path */}
        <details className="w-full max-w-md">
          <summary className="text-sm text-gray-400 dark:text-gray-500 cursor-pointer hover:text-gray-600 dark:hover:text-gray-300 select-none">
            Or paste text
          </summary>
          <div className="mt-3 flex flex-col gap-3">
            <textarea
              value={pasteText}
              onChange={(e) => setPasteText(e.target.value)}
              placeholder="Paste your text here..."
              rows={6}
              className="w-full px-3 py-2 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <button
              onClick={handlePasteSubmit}
              disabled={!pasteText.trim()}
              className="self-end px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-40 disabled:cursor-not-allowed"
            >
              Read text
            </button>
          </div>
        </details>
      </main>
    </div>
  )
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` — no TypeScript errors. Confirm that all user decisions from CONTEXT.md are implemented:
- Import button disabled when !isWorkerReady
- Spinner appears when isProcessing
- Patience message shown after 3s (setShowPatience inside setTimeout(3000))
- Cancel button visible during processing
- Error auto-dismisses (errorTimerRef set to 4000ms)
- Paste text is in a `details`/`summary` collapsible (secondary, not prominent)
- Header has app name + settings icon
  </verify>
  <done>
EntryScreen.tsx exists with all locked user decisions implemented: disabled import button on WASM not-ready, spinner + patience + cancel during processing, 4-second auto-dismiss error, paste text as secondary collapsible section, header with app name + settings icon. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build TextPreview and RSVPPlaceholder screens, update App.tsx to use real components</name>
  <files>
    src/components/TextPreview/TextPreview.tsx
    src/components/RSVPPlaceholder/RSVPPlaceholder.tsx
    src/App.tsx
  </files>
  <action>
Create `src/components/TextPreview/TextPreview.tsx`:

User decisions (NON-NEGOTIABLE from CONTEXT.md):
- Shows: first paragraph of extracted text (quality check) + word count at top
- Read-only — user cannot edit extracted text
- "Start Reading" button at the TOP, above the preview text
- In Phase 1: "Start Reading" navigates to /read (placeholder)
- Back button returns to /

```typescript
import React from 'react'
import { useNavigate } from 'react-router-dom'
import { useRsvpStore } from '../../store/rsvp-store'

export default function TextPreview() {
  const navigate = useNavigate()
  const wordList = useRsvpStore((s) => s.wordList)
  const documentTitle = useRsvpStore((s) => s.documentTitle)

  // Redirect to entry if no document loaded (e.g., direct URL access)
  React.useEffect(() => {
    if (wordList.length === 0) {
      navigate('/', { replace: true })
    }
  }, [wordList, navigate])

  // First paragraph: take up to 200 words for quality check
  const previewWords = wordList.slice(0, 200)
  const previewText = previewWords.join(' ')
  const wordCount = wordList.length

  return (
    <div className="min-h-screen bg-white dark:bg-gray-950 flex flex-col">
      {/* Header */}
      <header className="flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-800">
        <button
          onClick={() => navigate('/')}
          className="flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            strokeWidth={2}
          >
            <path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
          Back
        </button>
        <span className="text-sm font-medium text-gray-900 dark:text-white">
          {documentTitle ?? 'Document Preview'}
        </span>
        <div className="w-12" aria-hidden="true" /> {/* spacer for centering */}
      </header>

      <main className="flex-1 flex flex-col max-w-2xl w-full mx-auto px-4 py-6 gap-4">
        {/* Word count — at top */}
        <div className="flex items-center justify-between">
          <span className="text-sm font-medium text-gray-500 dark:text-gray-400">
            {wordCount.toLocaleString()} words
          </span>
        </div>

        {/* "Start Reading" button — at top, above preview text (user decision) */}
        <button
          onClick={() => navigate('/read')}
          className="w-full py-3 text-base font-semibold text-white bg-blue-600 rounded-xl hover:bg-blue-700 active:bg-blue-800 transition-colors"
        >
          Start Reading
        </button>

        {/* Text preview — read-only quality check */}
        <div className="flex-1">
          <p className="text-xs text-gray-400 dark:text-gray-500 mb-2 uppercase tracking-wide">
            Preview (first ~200 words)
          </p>
          <div className="p-4 rounded-xl bg-gray-50 dark:bg-gray-900 border border-gray-100 dark:border-gray-800">
            <p className="text-sm leading-relaxed text-gray-700 dark:text-gray-300">
              {previewText}
              {wordList.length > 200 && (
                <span className="text-gray-400 dark:text-gray-500"> ...</span>
              )}
            </p>
          </div>
        </div>
      </main>
    </div>
  )
}
```

---

Create `src/components/RSVPPlaceholder/RSVPPlaceholder.tsx`:

```typescript
import React from 'react'
import { useNavigate } from 'react-router-dom'
import { useRsvpStore } from '../../store/rsvp-store'

/**
 * Phase 1 placeholder RSVP screen.
 * Makes the phase end-to-end testable: EntryScreen → TextPreview → here.
 * Phase 2 replaces this with the full RSVP playback engine.
 */
export default function RSVPPlaceholder() {
  const navigate = useNavigate()
  const wordList = useRsvpStore((s) => s.wordList)
  const documentTitle = useRsvpStore((s) => s.documentTitle)

  return (
    <div className="min-h-screen bg-white dark:bg-gray-950 flex flex-col items-center justify-center px-4 gap-6">
      <div className="text-center">
        <p className="text-xs font-medium text-blue-500 uppercase tracking-widest mb-2">
          Phase 2 Coming
        </p>
        <h1 className="text-4xl font-bold text-gray-900 dark:text-white mb-1">
          RSVP
        </h1>
        <p className="text-sm text-gray-500 dark:text-gray-400">
          {documentTitle ? `"${documentTitle}"` : 'Untitled'} —{' '}
          {wordList.length.toLocaleString()} words ready
        </p>
      </div>

      {/* Show the first word as a teaser */}
      {wordList.length > 0 && (
        <div className="px-8 py-6 rounded-2xl bg-gray-50 dark:bg-gray-900 border border-gray-100 dark:border-gray-800 text-center min-w-48">
          <span className="text-3xl font-medium text-gray-800 dark:text-gray-100">
            {wordList[0]}
          </span>
          <p className="text-xs text-gray-400 mt-2">First word</p>
        </div>
      )}

      <button
        onClick={() => navigate('/preview')}
        className="px-5 py-2.5 text-sm text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-700 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800"
      >
        Back to Preview
      </button>
    </div>
  )
}
```

---

Update `src/App.tsx` to import the real components (replacing the Plan 03 placeholders):

```typescript
import React from 'react'
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import EntryScreen from './components/EntryScreen/EntryScreen'
import TextPreview from './components/TextPreview/TextPreview'
import RSVPPlaceholder from './components/RSVPPlaceholder/RSVPPlaceholder'

export default function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/*
          Route: Entry screen
          Not destroyed on navigation — React Router keeps it mounted
          while the user is on /preview or /read (BrowserRouter default behavior).
        */}
        <Route path="/" element={<EntryScreen />} />

        {/*
          Route: Text preview — extracted text quality check + word count
        */}
        <Route path="/preview" element={<TextPreview />} />

        {/*
          Route: RSVP reader — placeholder for Phase 1, real engine in Phase 2
        */}
        <Route path="/read" element={<RSVPPlaceholder />} />
      </Routes>
    </BrowserRouter>
  )
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` — no errors. Then run `npm run dev` and verify:
1. http://localhost:5173/ loads EntryScreen (header visible, drop zone visible, paste text collapsed)
2. Type some text in paste textarea, submit — navigates to /preview showing word count + preview text + Start Reading button at top
3. Click Start Reading → navigates to /read, shows first word from the text
4. Click Back to Preview → returns to /preview
5. Click Back in TextPreview header → returns to /
  </verify>
  <done>
Three real component files replace the Plan 03 placeholders. App.tsx imports from component files. Full paste-text flow works end-to-end (EntryScreen → TextPreview → RSVPPlaceholder → back). "Start Reading" button is above the preview text (user decision). TextPreview shows word count. RSVPPlaceholder shows first word and total word count. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no errors
2. `npm run dev` — dev server starts, no console errors
3. Paste text flow: paste text → /preview shows word count + preview → /read shows first word → back to preview → back to entry
4. Error scenario: verify error state shows, then disappears after ~4 seconds (manual test with invalid input)
5. Import button is disabled initially (before Worker Init fires) — visible in dev: briefly disabled on page load
6. All three component files exist: EntryScreen.tsx, TextPreview.tsx, RSVPPlaceholder.tsx
</verification>

<success_criteria>
- All locked user decisions from CONTEXT.md implemented in EntryScreen
- Full paste-text flow works end-to-end (IMPT-04 path)
- TextPreview: word count + first paragraph (up to 200 words) + Start Reading button at top
- RSVPPlaceholder: shows document title and word count (Phase 1 testable)
- No TypeScript errors
- System (OS) theme respected via Tailwind dark: variants — no manual toggle
</success_criteria>

<output>
After completion, create `/Users/nousunio/Repos/Learnings/claude-code/text-to-voice/.planning/phases/01-wasm-pipeline-document-service/01-05-SUMMARY.md`
</output>
