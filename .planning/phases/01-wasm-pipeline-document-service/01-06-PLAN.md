---
phase: 01-wasm-pipeline-document-service
plan: "06"
type: execute
wave: 5
depends_on:
  - "01-05"
files_modified: []
autonomous: false
requirements:
  - DOCF-01
  - IMPT-04

must_haves:
  truths:
    - "User can paste raw text and navigate through entry → preview → placeholder RSVP"
    - "User can import a text-layer PDF and see extracted words in the preview"
    - "A scanned/image PDF shows an actionable error message, not a crash"
    - "The compiled WASM bundle does not block the initial page render"
    - "Phase 1 success criteria are all verifiable by the human"
  artifacts:
    - path: "rsvp-parser/crates/rsvp-parser/pkg/rsvp_parser_bg.wasm"
      provides: "Compiled WASM binary serving PDF extraction"
      min_lines: 0
    - path: "src/components/EntryScreen/EntryScreen.tsx"
      provides: "Import screen with all locked UI decisions"
      min_lines: 120
  key_links:
    - from: "EntryScreen (browser)"
      to: "WASM Worker"
      via: "documentService.parseFile() → Worker postMessage → parse_pdf() → words array"
      pattern: "End-to-end PDF parse verified by human"
---

<objective>
Final human verification of Phase 1. Runs the full app in production build mode, walks through all four Phase 1 success criteria from ROADMAP.md, and confirms the phase is complete.

Purpose: Automated TypeScript checks cannot verify: WASM actually runs in browser, PDF extraction produces readable words, scanned PDF error is visible, bundle doesn't block render. Human verification closes the loop.

Output: Human confirmation that Phase 1 is shippable. Phase 2 planning can begin.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-wasm-pipeline-document-service/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Production build and pre-verification checks</name>
  <files></files>
  <action>
Run the production build and verify bundle integrity:

```bash
# 1. Production build
cd /Users/nousunio/Repos/Learnings/claude-code/text-to-voice
npm run build 2>&1

# 2. Verify WASM is a separate asset (not inlined into JS)
# Should show a .wasm file in dist/assets/, NOT embedded in any .js file
ls -la dist/assets/*.wasm 2>/dev/null || echo "WARNING: no .wasm file found in dist/assets/"

# 3. Check WASM bundle size against the 2 MB target
wasm_file=$(ls dist/assets/*.wasm 2>/dev/null | head -1)
if [ -n "$wasm_file" ]; then
  size=$(stat -f%z "$wasm_file" 2>/dev/null || stat -c%s "$wasm_file" 2>/dev/null)
  echo "WASM bundle size: ${size} bytes (target: under 2,097,152)"
  if [ "$size" -gt 2097152 ]; then
    echo "WARNING: WASM bundle exceeds 2 MB target"
  else
    echo "OK: WASM bundle is within target"
  fi
fi

# 4. Preview the production build
npm run preview &
PREVIEW_PID=$!
echo "Preview server PID: $PREVIEW_PID"
echo "Production preview running at http://localhost:4173"
echo "Stop with: kill $PREVIEW_PID"
```

Record any build warnings or errors. If build fails, report the error message — do not attempt to fix without user input.
  </action>
  <verify>
`npm run build` exits with code 0. A .wasm file exists in dist/assets/. Preview server starts at localhost:4173.
  </verify>
  <done>
Production build succeeds. WASM file exists in dist/assets/ as a separate asset (not inlined). Bundle size measured and logged against the 2 MB target. Preview server running.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 pipeline: Rust WASM crate (PDF extraction), Web Worker (WASM host), DocumentService (main-thread facade), EntryScreen (import hero), TextPreview (quality check), RSVPPlaceholder (Phase 1 end-to-end testable).
  </what-built>
  <how-to-verify>
Open http://localhost:4173 (production preview) and test all four Phase 1 success criteria from ROADMAP.md:

**Criteria 1: Paste text → preview → placeholder RSVP**
1. Open http://localhost:4173
2. Click "Or paste text" to expand the paste section
3. Paste any paragraph of text (at least 20 words)
4. Click "Read text"
5. Expected: navigates to /preview — shows word count (should match your word count) and a preview of the text
6. Click "Start Reading" (should be at the TOP of the page, above the preview text)
7. Expected: navigates to /read — shows word count and first word of your text
8. Click "Back to Preview" → "Back" in header — confirms full round-trip

**Criteria 2: Text-layer PDF → extracted words in preview**
1. From the entry screen, drop a text-layer PDF onto the drop zone OR click "Choose PDF"
2. Expected during processing: spinner visible in the drop zone area, Cancel button visible
3. Expected on success: navigates to /preview — shows word count and first paragraph of PDF text
4. Verify the extracted text is readable (not garbled characters)
5. Note: if you don't have a text-layer PDF handy, any PDF you can normally copy text from in a viewer will work

**Criteria 3: Scanned/image PDF → user-facing error message**
1. Import a scanned or image-only PDF (if available)
2. Expected: visible error message in the entry screen (red banner), NOT a crash
3. Error message should mention "scanned or image-based" and suggest alternatives
4. Expected: error disappears automatically after ~4 seconds
5. Note: if no scanned PDF is available, you can verify this path by checking the source code

**Criteria 4: WASM init does not block page render**
1. Open browser DevTools → Performance tab → record a fresh page load
2. Expected: the React app renders immediately (header + drop zone visible within 100ms)
3. The import button starts disabled (briefly) and enables when WASM init completes
4. Expected: no blank screen while WASM compiles — content is visible immediately

**Additional checks:**
- System dark mode: toggle your OS dark/light mode setting — the app should follow it
- WASM bundle size: Task 1 logs the size — confirm it's under 2 MB (or note the actual size)

Report any issues with specifics: which criterion failed, what you saw vs. what was expected.
  </how-to-verify>
  <resume-signal>
Type "Phase 1 approved" if all criteria pass. Or describe any issues (e.g., "Criterion 2 failed: PDF extraction returned empty words" or "Criterion 3 failed: app crashed instead of showing error").
  </resume-signal>
</task>

</tasks>

<verification>
All four ROADMAP.md Phase 1 success criteria verified by human:
1. Paste text → preview (word count visible) → placeholder RSVP → back to entry
2. Text-layer PDF → preview (readable extracted words + word count)
3. Scanned PDF → visible, actionable error message that auto-dismisses
4. WASM does not block first render (content visible immediately, import button starts disabled)
</verification>

<success_criteria>
Human confirms all four Phase 1 success criteria from ROADMAP.md pass in production build. Phase 2 planning can begin.
</success_criteria>

<output>
After completion, create `/Users/nousunio/Repos/Learnings/claude-code/text-to-voice/.planning/phases/01-wasm-pipeline-document-service/01-06-SUMMARY.md`
</output>
