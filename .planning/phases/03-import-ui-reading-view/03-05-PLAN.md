---
phase: 03-import-ui-reading-view
plan: 05
type: execute
wave: 4
depends_on: [03-04]
files_modified: []
autonomous: false
requirements: [IMPT-02, IMPT-03, VIEW-01, VIEW-02, VIEW-03, VIEW-04]

must_haves:
  truths:
    - "Importing a PDF via file picker shows the enhanced TextPreview with word count, reading time estimate, and scrollable fade preview"
    - "The /read screen shows a sticky RSVP zone and independently scrollable text panel"
    - "Current word in text panel is highlighted in yellow and the panel auto-scrolls to keep it in view during playback"
    - "Text panel dims to ~50% opacity while playing and returns to full when paused"
    - "Gear icon opens FontSizePanel with independent +/- controls for RSVP word and full text font sizes"
    - "Font size changes survive a page refresh"
    - "Drag-and-drop PDF import on the entry screen continues to work"
  artifacts:
    - path: "src/components/RSVPReader/RSVPReader.tsx"
      provides: "Dual-view reading layout"
      contains: "TextPanel"
    - path: "src/components/RSVPReader/TextPanel.tsx"
      provides: "Scrollable word list with highlight, auto-scroll, dimming"
    - path: "src/components/RSVPReader/FontSizePanel.tsx"
      provides: "Font size +/- controls"
    - path: "src/components/TextPreview/TextPreview.tsx"
      provides: "Enhanced import confirmation with metadata and fade preview"
    - path: "public/manifest.json"
      provides: "PWA manifest with share_target entry"
  key_links:
    - from: "EntryScreen file picker"
      to: "TextPreview"
      via: "navigate('/preview') after documentService.parseFile"
      pattern: "navigate.*preview"
    - from: "TextPreview Start Reading button"
      to: "RSVPReader dual-view"
      via: "navigate('/read')"
      pattern: "navigate.*read"
---

<objective>
Human verification of all Phase 3 success criteria. Confirms the complete import-to-reading flow works end-to-end: file picker import → enhanced TextPreview → dual-view RSVPReader with word tracking, dimming, and font size controls.

Purpose: Phase 3 is complete only when a human verifies the visual and interactive experience matches the locked user decisions from CONTEXT.md. Automated tests cannot verify layout proportions, scroll feel, or visual highlight quality.
Output: Phase 3 verified and declared complete.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/03-import-ui-reading-view/03-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build production bundle and run final automated checks</name>
  <files></files>
  <action>
Run the complete test and build sequence before presenting the human verification checkpoint:

```bash
cd /workspace
nvm use 22
npm test 2>&1          # All unit tests must pass
npm run build 2>&1     # Production build must exit 0
```

Then start the preview server:
```bash
npm run preview 2>&1 &
```

Confirm the preview server is running at http://localhost:4173 (Vite's default preview port).

Also verify:
1. `dist/manifest.json` exists (Web Share Target manifest shipped)
2. `dist/share-target-sw.js` exists (service worker handler shipped)
3. `dist/assets/` contains the WASM file (no regression on WASM pipeline)

Report any failures — do NOT proceed to the checkpoint if the build fails.
  </action>
  <verify>
    <automated>cd /workspace && nvm use 22 2>/dev/null; npm test 2>&1 | tail -5 && npm run build 2>&1 | tail -5 && ls dist/manifest.json dist/share-target-sw.js 2>&1</automated>
    <manual>Confirm all tests pass and build exits 0 before checkpoint.</manual>
  </verify>
  <done>All unit tests pass. Production build exits 0. manifest.json and share-target-sw.js present in dist/. Preview server running at localhost:4173.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of all six Phase 3 requirements</name>
  <files></files>
  <action>Human verifies all Phase 3 requirements at http://localhost:4173 per the how-to-verify instructions below.</action>
  <verify>Human types "approved" after confirming all 7 verification tests pass.</verify>
  <done>All 6 Phase 3 requirements (IMPT-02, IMPT-03, VIEW-01, VIEW-02, VIEW-03, VIEW-04) confirmed by human. Phase 3 declared complete.</done>
  <what-built>
Phase 3 complete feature set:
- Enhanced TextPreview: scrollable preview with fade gradient, word count, reading time estimate
- Dual-view RSVPReader: sticky RSVP zone (~40% height) + scrollable full-text panel (~60%)
- Word highlighting: current word highlighted in yellow in text panel, auto-scrolls to stay in view
- Dimming: text panel dims to ~50% opacity while playing, returns to full when paused
- Font size controls: gear icon in PlaybackControls opens +/- panel for RSVP word and full text sizes
- Font size persistence: sizes survive page refresh (Zustand localStorage persist)
- Web Share Target manifest: public/manifest.json with share_target entry (Android Chrome activation requires Phase 4 PWA)
- File picker + drag-drop: EntryScreen import paths unchanged and functional
  </what-built>
  <how-to-verify>
Open http://localhost:4173 in your browser.

**Test 1 — File picker import (IMPT-03) + TextPreview (VIEW-03):**
1. Click "Choose PDF" and select a multi-page PDF
2. Confirm: scrollable text preview appears (first ~250 words), bottom edge fades out
3. Confirm: metadata area shows word count and estimated reading time (e.g., "~4 min read")
4. Confirm: "Start Reading" button is visible and prominent above the preview

**Test 2 — Dual-view reading layout (VIEW-01):**
1. From TextPreview, click "Start Reading"
2. Confirm: top ~40% of screen is the RSVP zone (word display + controls) — does NOT scroll
3. Confirm: bottom ~60% of screen is scrollable text (all document words)
4. Click play (▶) and confirm: current word is highlighted in yellow in the text panel
5. Confirm: text panel auto-scrolls so the highlighted word stays in view during playback
6. Manually scroll the text panel mid-playback — confirm: auto-scroll pauses for ~2 seconds then resumes

**Test 3 — Text panel dimming (VIEW-02):**
1. With RSVP playing, confirm the text panel is visibly dimmed (~50% opacity)
2. Pause playback — confirm text panel returns to full brightness
3. Resume — confirm it dims again

**Test 4 — Font size controls (VIEW-04):**
1. Click the gear icon (⚙) in the playback controls area
2. Confirm: a panel appears with two rows — "RSVP word" and "Full text" with +/- buttons
3. Click + on "RSVP word" — confirm the RSVP word display gets larger
4. Click − on "Full text" — confirm the text panel words get smaller
5. Reload the page and navigate to /read — confirm font sizes are preserved (not reset to defaults)

**Test 5 — Mobile layout (mobile viewport):**
1. Open DevTools and switch to a mobile viewport (e.g., iPhone 12, 390x844)
2. Confirm: RSVP zone and text panel stack vertically with the same proportions
3. Confirm: no horizontal scrolling needed to see any controls

**Test 6 — Drag-and-drop (IMPT-03 secondary path):**
1. Navigate to http://localhost:4173/
2. Drag a PDF file onto the drop zone
3. Confirm: processing spinner appears, then TextPreview loads with the extracted text

**Test 7 — Paste text path:**
1. Expand "Or paste text" on the entry screen
2. Paste some text and click "Read text"
3. Confirm: TextPreview loads with word count and reading time (no filename)
4. Click "Start Reading" and confirm the dual-view reading screen works with pasted text
  </how-to-verify>
  <resume-signal>
Type "approved" if all 7 tests pass.
Or describe any issues found — provide specific test number and behavior observed vs expected.
  </resume-signal>
</task>

</tasks>

<verification>
All 7 verification tests must pass for Phase 3 to be declared complete.

Requirements verified:
- IMPT-02: manifest.json present in dist/ with share_target entry; SW handler exists
- IMPT-03: File picker and drag-drop import work end-to-end to TextPreview
- VIEW-01: Dual-view layout with sticky RSVP zone and scrollable TextPanel with word highlight + auto-scroll
- VIEW-02: Text panel opacity transition (playing = 50%, paused = 100%)
- VIEW-03: Enhanced TextPreview with scrollable fade preview, word count, reading time
- VIEW-04: Independent font size controls persisted across refresh
</verification>

<success_criteria>
All 6 Phase 3 requirements (IMPT-02, IMPT-03, VIEW-01, VIEW-02, VIEW-03, VIEW-04) confirmed by human in production build.
Phase 3 milestone declared complete. Phase 4 (PWA + Web Share Target) unblocked.
</success_criteria>

<output>
After completion, create `.planning/phases/03-import-ui-reading-view/03-05-SUMMARY.md`
</output>
