---
phase: 02-rsvp-playback-engine
plan: 04
type: execute
wave: 2
depends_on:
  - 02-02
files_modified:
  - src/components/RSVPReader/PlaybackControls.tsx
autonomous: true
requirements:
  - CTRL-01
  - CTRL-02
  - CTRL-03
  - CTRL-04

must_haves:
  truths:
    - "PlaybackControls renders a single row with: jump-back button, play/pause button, jump-forward button, WPM slider with preset buttons, and WPM value display"
    - "Pressing play/pause button toggles isPlaying in the store"
    - "Pressing << / >> buttons jump backward/forward by jumpSize words (clamped at 0 and wordList.length-1)"
    - "WPM slider has range 50–1000, step 25, and changes wpm in the store live (per user decision)"
    - "Preset buttons [200] [300] [500] set wpm directly when clicked (per user decision)"
    - "Jump size stepper (- N +) sits inline next to the << >> buttons and adjusts jumpSize in store (per user decision)"
    - "All controls are part of PlaybackControls component only — keyboard shortcuts are wired in RSVPReader (Plan 05)"
  artifacts:
    - path: "src/components/RSVPReader/PlaybackControls.tsx"
      provides: "Single-row controls bar: jump buttons + jump-size stepper + play/pause + WPM slider + presets + WPM display"
      exports: ["PlaybackControls"]
      contains: "useRsvpStore"
  key_links:
    - from: "src/components/RSVPReader/PlaybackControls.tsx"
      to: "src/store/rsvp-store.ts"
      via: "setCurrentWordIndex, setIsPlaying, setJumpSize, setWpm — all store actions"
      pattern: "useRsvpStore"
---

<objective>
Build the `PlaybackControls` component — the single-row controls bar that sits directly below the dark word panel per the locked user decision from CONTEXT.md.

Layout (locked): `[<<] [-N+] [|>] [>>]  [----slider----]  [200] [300] [500]  250`

Where:
- `[<<]` / `[>>]` — jump back/forward N words (N = jumpSize from store, default 10)
- `[-N+]` — inline jump-size stepper: decrement, current value, increment
- `[|>]` / `[||]` — play/pause toggle
- `[----slider----]` — WPM range input (50–1000, step 25)
- `[200] [300] [500]` — preset WPM quick-select buttons
- `250` — current WPM value display

All interactions write to the Zustand store. Keyboard shortcuts (Space, ArrowLeft, ArrowRight) are NOT wired here — that is Plan 05's responsibility.

Purpose: Standalone controls component parallel to ORPDisplay/ProgressBar (Plan 03). Plan 05 assembles all components into the RSVPReader screen.

Output: `src/components/RSVPReader/PlaybackControls.tsx`
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-rsvp-playback-engine/02-CONTEXT.md
@.planning/phases/02-rsvp-playback-engine/02-RESEARCH.md
@.planning/phases/02-rsvp-playback-engine/02-02-SUMMARY.md
@src/store/rsvp-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlaybackControls component with all control elements</name>
  <files>src/components/RSVPReader/PlaybackControls.tsx</files>
  <action>
    Create `src/components/RSVPReader/PlaybackControls.tsx`.

    The component reads from and writes to Zustand store — no props needed for core functionality.

    Implementation structure:

    ```tsx
    import { useRsvpStore } from '../../store/rsvp-store'

    const WPM_PRESETS = [200, 300, 500] as const

    export function PlaybackControls() {
      const wpm = useRsvpStore((s) => s.wpm)
      const isPlaying = useRsvpStore((s) => s.isPlaying)
      const currentWordIndex = useRsvpStore((s) => s.currentWordIndex)
      const jumpSize = useRsvpStore((s) => s.jumpSize)
      const wordList = useRsvpStore((s) => s.wordList)
      const setWpm = useRsvpStore((s) => s.setWpm)
      const setIsPlaying = useRsvpStore((s) => s.setIsPlaying)
      const setCurrentWordIndex = useRsvpStore((s) => s.setCurrentWordIndex)
      const setJumpSize = useRsvpStore((s) => s.setJumpSize)

      // Clamp jump to word list bounds
      function jumpBack() {
        setCurrentWordIndex(Math.max(0, currentWordIndex - jumpSize))
      }
      function jumpForward() {
        setCurrentWordIndex(Math.min(wordList.length - 1, currentWordIndex + jumpSize))
      }
      function togglePlay() {
        setIsPlaying(!isPlaying)
      }

      return (
        <div className="flex items-center gap-3 flex-wrap justify-center">
          {/* Jump back + jump-size stepper + play/pause + jump forward */}
          <div className="flex items-center gap-2">
            <button onClick={jumpBack} aria-label="Jump back">«</button>
            {/* Jump-size stepper: [-] [N] [+] */}
            <div className="flex items-center gap-1">
              <button onClick={() => setJumpSize(Math.max(1, jumpSize - 5))} aria-label="Decrease jump size">-</button>
              <span className="text-sm text-gray-400 w-6 text-center tabular-nums">{jumpSize}</span>
              <button onClick={() => setJumpSize(Math.min(50, jumpSize + 5))} aria-label="Increase jump size">+</button>
            </div>
            <button onClick={togglePlay} aria-label={isPlaying ? 'Pause' : 'Play'}>
              {isPlaying ? '⏸' : '▶'}
            </button>
            <button onClick={jumpForward} aria-label="Jump forward">»</button>
          </div>

          {/* WPM slider */}
          <input
            type="range"
            min={50}
            max={1000}
            step={25}
            value={wpm}
            onChange={(e) => setWpm(Number(e.target.value))}
            className="flex-1 min-w-24 h-1.5 rounded-full appearance-none bg-gray-600
              [&::-webkit-slider-thumb]:appearance-none
              [&::-webkit-slider-thumb]:w-4
              [&::-webkit-slider-thumb]:h-4
              [&::-webkit-slider-thumb]:rounded-full
              [&::-webkit-slider-thumb]:bg-white
              cursor-pointer"
            aria-label="WPM slider"
          />

          {/* Preset buttons */}
          <div className="flex items-center gap-1">
            {WPM_PRESETS.map((preset) => (
              <button
                key={preset}
                onClick={() => setWpm(preset)}
                className={`px-2 py-1 text-xs rounded-md ${
                  wpm === preset
                    ? 'bg-white text-gray-900'
                    : 'text-gray-400 hover:text-white border border-gray-700 hover:border-gray-500'
                }`}
                aria-label={`Set ${preset} WPM`}
              >
                {preset}
              </button>
            ))}
          </div>

          {/* Current WPM display */}
          <span className="text-sm text-gray-300 tabular-nums w-12 text-right" aria-live="polite">
            {wpm}
          </span>
        </div>
      )
    }
    ```

    Key implementation constraints (all from locked CONTEXT.md decisions):
    - Slider range: 50–1000 WPM
    - Slider step: 25 WPM (Claude's discretion — matches RESEARCH.md code example)
    - Default jump size: 10 words (enforced by store default, not hardcoded here)
    - Jump clamping: `Math.max(0, ...)` on back, `Math.min(wordList.length - 1, ...)` on forward — per RESEARCH.md locked behavior
    - Presets: [200] [300] [500] — LOCKED per CONTEXT.md
    - `tabular-nums` on WPM display and jump-size number — prevents layout shift as digits change
    - Buttons use aria-label for accessibility
    - Jump size stepper: increment by 5 (Claude's discretion), clamped 1–50
    - Active preset button: visually distinguished (inverted colors)
    - All colors in dark palette (gray-600, gray-400, white) — sits below the dark word panel

    DO NOT wire keyboard shortcuts in this component — that is Plan 05's responsibility. The keyboard shortcuts call the same store actions (setIsPlaying, setCurrentWordIndex), but the event listeners live in RSVPReader.

    After writing, run: `nvm use 22 && npx tsc --noEmit`
    Commit: `feat(02-04): add PlaybackControls component`
  </action>
  <verify>
    <automated>cd /Users/nousunio/Repos/Learnings/claude-code/rsvp-reader-pwa && nvm use 22 && npx tsc --noEmit 2>&1 | head -10</automated>
    <manual>
    PlaybackControls.tsx exists. Contains: jump back/forward buttons, jump-size stepper ([-][N][+]), play/pause toggle, WPM range input (50-1000 step 25), preset buttons [200][300][500], WPM value display. All actions connect to useRsvpStore. No TypeScript errors.
    </manual>
  </verify>
  <done>
    PlaybackControls.tsx created with all control elements. Jump clamp logic correct. WPM slider range 50-1000 step 25. Presets [200][300][500]. Jump-size stepper with min=1 max=50 step=5. TypeScript clean. Committed.
  </done>
</task>

</tasks>

<verification>
TypeScript check: `nvm use 22 && npx tsc --noEmit` — 0 errors.
File exists: `src/components/RSVPReader/PlaybackControls.tsx`
Jump back clamps to 0: `Math.max(0, currentWordIndex - jumpSize)` present.
Jump forward clamps to last word: `Math.min(wordList.length - 1, currentWordIndex + jumpSize)` present.
Slider: min=50, max=1000, step=25.
Presets: 200, 300, 500.
</verification>

<success_criteria>
- All four CTRL requirements (CTRL-01 through CTRL-04) have their on-screen control implementation in PlaybackControls
- Jump clamping is correct at both boundaries (no negative index, no out-of-bounds)
- WPM slider takes effect immediately when dragged (onChange writes to store)
- TypeScript clean, production build ready
</success_criteria>

<output>
After completion, create `.planning/phases/02-rsvp-playback-engine/02-04-SUMMARY.md`
</output>
